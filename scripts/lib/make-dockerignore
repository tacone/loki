#!/usr/bin/env bash

# rebuilds (and totally replace).dockerignore to whitelists
# arbitrary directories.
# you have to run this withevery folder you want to refer to
# inside your Dockerfile(s)
#
# example (for directories frontend and backend):
# make-dockerignore frontend backend

make-dockerignore() {
    local f=$ROOT/.dockerignore

    echo > $f
    echo "### ------ DO NOT EDIT THIS FILE ------- ###" >> $f
    echo "#                                          #" >> $f
    echo "#     edit common.dockerignore instead     #" >> $f
    echo "#                                          #" >> $f
    echo "### ------------------------------------- ##" >> $f
    echo >> $f

    cat $ROOT/.common.dockerignore >> $f
    echo >> $f

    for project_dir in "$@"
    do
        echo "!/$project_dir" >> $f
    done

    echo
}